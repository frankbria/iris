# Git Commit Guide for IRIS Phase 2
**Status:** Ready for Commit
**Date:** September 30, 2025

---

## Pre-Commit Status

### Test Results ✅
- **Total Tests:** 223
- **Passing:** 221 (99.1%)
- **Skipped:** 2 (expected - implementation pending)
- **Failing:** 0

### Build Status ✅
- TypeScript compilation: **SUCCESS**
- No compilation errors
- All dependencies installed

---

## Files to Commit

### Source Code (COMMIT)

**Phase 1 Core (Modified)**
```bash
git add src/cli.ts
git add src/executor.ts
git add src/browser.ts
git add src/translator.ts
git add src/protocol.ts
git add src/ai-client.ts
git add src/config.ts
git add src/db.ts
git add src/watcher.ts
```

**Phase 2 Visual Module (NEW)**
```bash
git add src/visual/
# Includes:
# - src/visual/index.ts
# - src/visual/types.ts
# - src/visual/capture.ts
# - src/visual/diff.ts
# - src/visual/baseline.ts
```

**Phase 2 Accessibility Module (NEW)**
```bash
git add src/a11y/
# Includes:
# - src/a11y/index.ts
# - src/a11y/types.ts
```

**Phase 2 Utils Module (NEW)**
```bash
git add src/utils/
# Includes:
# - src/utils/index.ts
# - src/utils/types.ts
# - src/utils/migration.ts
```

### Test Files (COMMIT)

```bash
git add __tests__/visual/
git add __tests__/a11y/
git add __tests__/utils/
# All other test files already tracked
```

### Documentation (COMMIT)

```bash
git add docs/phase2_technical_architecture.md
git add DEVELOPMENT_INSTRUCTIONS.md
git add GIT_COMMIT_GUIDE.md
git add PHASE2_SETUP_SUMMARY.md
```

### Configuration (COMMIT - Modified)

```bash
git add package.json
git add package-lock.json
git add tsconfig.json
git add jest.config.ts
```

### Planning Files (COMMIT)

```bash
git add plan/phase2_todo.md
# Other plan files already tracked
```

---

## Files to IGNORE (DO NOT COMMIT)

### Build Output (Auto-Generated)
```bash
# DO NOT COMMIT
dist/                  # TypeScript build output (regenerated by npm run build)
```

### Test Coverage (Auto-Generated)
```bash
# DO NOT COMMIT
coverage/              # Test coverage reports (regenerated by npm test)
coverage/clover.xml
coverage/coverage-final.json
coverage/lcov.info
coverage/lcov-report/
```

### Jest Setup (Auto-Generated)
```bash
# DO NOT COMMIT
jest.setup.js         # Compiled from jest.setup.ts
jest.setup.js.map
jest.setup.d.ts
jest.setup.d.ts.map
```

### Dependencies (Installed via npm)
```bash
# DO NOT COMMIT (already in .gitignore)
node_modules/
```

### Environment Files (Secrets)
```bash
# DO NOT COMMIT (should be in .gitignore)
.env
.env.local
*.key
```

---

## Recommended Commit Commands

### Option 1: Selective Staging (Recommended)

```bash
# Stage all source code changes
git add src/

# Stage test files
git add __tests__/visual/ __tests__/a11y/ __tests__/utils/

# Stage documentation
git add docs/phase2_technical_architecture.md
git add DEVELOPMENT_INSTRUCTIONS.md
git add GIT_COMMIT_GUIDE.md
git add PHASE2_SETUP_SUMMARY.md

# Stage configuration changes
git add package.json package-lock.json tsconfig.json jest.config.ts

# Stage planning files
git add plan/phase2_todo.md

# Review what will be committed
git status

# Commit with comprehensive message
git commit -m "feat(phase2): implement visual regression core infrastructure

Phase 2 Status: ~40% Complete - Core Infrastructure Implemented

✅ Implemented Components:
- Visual capture engine with stabilization & masking (src/visual/capture.ts)
- Visual diff engine with SSIM & pixel comparison (src/visual/diff.ts)
- Git-integrated baseline manager (src/visual/baseline.ts)
- Complete TypeScript/Zod type system (src/visual/types.ts)
- Database migration framework (src/utils/migration.ts)
- Accessibility type definitions (src/a11y/types.ts)
- Comprehensive test coverage (221/223 passing, 99.1%)

📦 Dependencies Added:
- sharp: High-performance image processing
- pixelmatch: Pixel-level diff detection
- image-ssim: Structural similarity comparison
- simple-git: Git baseline integration
- @axe-core/playwright: Accessibility testing
- zod: Runtime type validation

🔴 Remaining Work (Phase 2):
- AI visual classification integration
- CLI command implementation (visual-diff, a11y)
- HTML/JUnit report generation
- Accessibility testing implementation
- Full E2E orchestration pipeline

Test Status: 221 passing, 2 skipped (99.1% pass rate)
Phase 1: 100% complete and stable
Phase 2: Core engines operational, integration pending

Breaking Changes: None
Migration: Backward compatible with Phase 1

See DEVELOPMENT_INSTRUCTIONS.md for detailed continuation plan
See docs/phase2_technical_architecture.md for complete architecture
"
```

### Option 2: Review-First Approach

```bash
# Review all changes first
git status
git diff src/
git diff __tests__/
git diff package.json

# Stage incrementally after review
git add -p  # Interactive staging

# Commit when satisfied
git commit
```

---

## Pre-Commit Validation

Run these commands before committing:

```bash
# 1. Ensure tests pass
npm test
# Expected: 221 passing, 2 skipped

# 2. Ensure build succeeds
npm run build
# Expected: No TypeScript errors

# 3. Review git status
git status
# Verify only intended files are staged

# 4. Review diff
git diff --cached
# Confirm changes are correct
```

---

## Post-Commit Actions

### Verify Commit

```bash
# Check commit was successful
git log -1 --stat

# Verify working tree is clean (except coverage/)
git status
```

### Optional: Create Tag

```bash
# Tag this milestone
git tag -a v0.2.0-phase2-core -m "Phase 2 Core Infrastructure Complete"

# Push tag
git push origin v0.2.0-phase2-core
```

### Push to Remote

```bash
# Push to main branch (or feature branch)
git push origin main

# Or push to feature branch
git push origin feature/phase2-visual-regression
```

---

## Git Ignore Recommendations

Ensure `.gitignore` includes:

```gitignore
# Build output
/dist/
*.js.map
*.d.ts
*.d.ts.map

# Test coverage
/coverage/

# Dependencies
/node_modules/

# Environment
.env
.env.local
.env.*.local

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Database (development)
*.sqlite
*.db

# Temporary files
*.tmp
.iris/
```

---

## Commit Message Template

If you prefer a different format:

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Types:**
- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation only
- `style`: Formatting, missing semicolons, etc.
- `refactor`: Code change that neither fixes a bug nor adds a feature
- `test`: Adding missing tests
- `chore`: Changes to build process or auxiliary tools

**Example:**

```
feat(visual): implement visual regression core engines

Implement Phase 2 visual regression testing infrastructure:

- Visual capture engine with page stabilization
- SSIM and pixel-based diff engine
- Git-integrated baseline manager
- Complete TypeScript type system
- Database schema extensions

Test coverage: 221/223 passing (99.1%)
Phase 1 stability: No regressions

BREAKING CHANGE: None
Migration: Fully backward compatible

Refs: #123 (if you have issue tracking)
```

---

## What NOT to Commit

**Never commit:**
1. ❌ Build artifacts (`dist/`, `*.js`, `*.js.map` from `src/`)
2. ❌ Test coverage reports (`coverage/`)
3. ❌ Dependencies (`node_modules/`)
4. ❌ Environment files (`.env`, secrets)
5. ❌ IDE-specific files (`.vscode/`, `.idea/`)
6. ❌ OS-specific files (`.DS_Store`, `Thumbs.db`)
7. ❌ Log files (`*.log`)
8. ❌ Database files (`.sqlite`, `.db`)
9. ❌ Temporary files (`*.tmp`)

**Always commit:**
1. ✅ Source code (`src/`)
2. ✅ Tests (`__tests__/`)
3. ✅ Documentation (`docs/`, `*.md`)
4. ✅ Configuration (`package.json`, `tsconfig.json`, `jest.config.ts`)
5. ✅ Planning files (`plan/`)

---

## Troubleshooting

### Issue: Untracked files in git status

**Problem:**
```
?? coverage/
?? dist/
?? jest.setup.js
```

**Solution:**
These are auto-generated files. Add to `.gitignore`:
```bash
echo "coverage/" >> .gitignore
echo "dist/" >> .gitignore
echo "jest.setup.js" >> .gitignore
echo "jest.setup.js.map" >> .gitignore
echo "jest.setup.d.ts" >> .gitignore
echo "jest.setup.d.ts.map" >> .gitignore
git add .gitignore
```

### Issue: Modified files you don't recognize

**Problem:**
```
M coverage/clover.xml
M coverage/coverage-final.json
```

**Solution:**
These are test coverage files. Don't commit them:
```bash
git restore coverage/
```

### Issue: Want to unstage files

**Problem:**
Accidentally staged files you don't want to commit.

**Solution:**
```bash
# Unstage specific file
git restore --staged <file>

# Unstage all files
git restore --staged .

# Then re-add only what you want
git add src/ __tests__/ docs/
```

---

## Summary Checklist

Before running `git commit`:

- [ ] Tests passing (221/223)
- [ ] Build successful (`npm run build`)
- [ ] Only source, tests, docs, and config staged
- [ ] No build artifacts staged (dist/, coverage/)
- [ ] No secrets or .env files staged
- [ ] Commit message is descriptive
- [ ] `.gitignore` is properly configured

After `git commit`:

- [ ] Verify commit with `git log -1 --stat`
- [ ] Working tree clean (except coverage/)
- [ ] Ready to push to remote
- [ ] Documentation updated (DEVELOPMENT_INSTRUCTIONS.md)

---

**Ready to Commit!** ✅

The codebase is in a stable state with:
- Phase 1: 100% complete and tested
- Phase 2: 40% complete with core infrastructure operational
- All tests passing (221/223)
- Comprehensive documentation
- Clear path for continued development

Execute the commit commands above to save this milestone.
